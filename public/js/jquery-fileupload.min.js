!function(t){function e(e,s){this.element=e,this.$form=t(e),this.$uploaders=t("input[type=file]",this.element),this.files={},this.settings=t.extend({},i,s),this._defaults=i,this._name=n,this.init()}var n="fileUpload",i={uploadData:{},submitData:{},uploadOptions:{},submitOptions:{},before:function(){},beforeSubmit:function(){return!0},success:function(){},error:function(){},complete:function(){}};e.prototype={init:function(){this.$uploaders.on("change",{context:this},this.processFiles),this.$form.on("submit",{context:this},this.uploadFiles)},processFiles:function(e){var n=e.data.context;n.files[t(e.target).attr("name")]=e.target.files},uploadFiles:function(e){e.stopPropagation(),e.preventDefault();var n=e.data.context;n.settings.before();var i=new FormData;i.append("file_upload_incoming","1"),t.each(n.files,function(e,n){t.each(n,function(t,e){i.append(t,e)})}),t.each(n.settings.uploadData,function(t,e){i.append(t,e)}),t.ajax(t.extend({},{url:n.$form.attr("action"),type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t){n.processSubmit(e,t)},error:function(t,e,i){n.settings.error(t,e,i)}},n.settings.uploadOptions))},processSubmit:function(e,n){var i=e.data.context;if(i.settings.beforeSubmit(n)){var s=i.$form.serializeArray();t.each(n,function(t,e){s.push({name:t,value:e})}),t.each(i.settings.submitData,function(t,e){s.push({name:t,value:e})}),t.ajax(t.extend({},{url:i.$form.attr("action"),type:"POST",data:s,cache:!1,dataType:"json",success:function(t,e,n){i.settings.success(t,e,n)},error:function(t,e,n){i.settings.error(t,e,n)},complete:function(t,e){i.settings.complete(t,e)}},i.settings.submitOptions))}}},t.fn[n]=function(i){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new e(this,i))})}}(jQuery,window,document);